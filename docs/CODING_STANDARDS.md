# AgentForge — Healthcare RCM AI Agent
## Coding Standards

**For:** Cursor AI Agent
**Project:** AgentForge — Gauntlet AI Program
**Note:** This document is for development use only — not for submission

---

## 1. Test-Driven Development (TDD) — MANDATORY

Every single file must follow this exact sequence. No exceptions.

**Sequence:**
1. Write the test file first
2. Run tests — confirm they FAIL
3. Write the implementation file
4. Run tests — confirm they PASS
5. Save results to `tests/results/` with a descriptive filename

**Never write implementation before tests exist.**
**Never skip saving results — they are proof of TDD.**

---

## 2. Module Docstring — Every File

The very first thing in every Python file must be a docstring in this exact format:

```
"""
filename.py
-----------
AgentForge — Healthcare RCM AI Agent — [One line description]
--------------------------------------------------------------
[2-3 sentences describing what this module does and why it exists]

[List of key functions or classes if applicable]

Author: Shreelakshmi Gopinatha Rao
Project: AgentForge — Healthcare RCM AI Agent
"""
```

---

## 3. Function Docstring — Every Function

Every function must have a docstring in this exact format:

```
def function_name(param1: str, param2: int) -> dict:
    """
    One sentence describing what this function does.

    Args:
        param1: What this parameter is and what values are valid
        param2: What this parameter is and what values are valid

    Returns:
        dict: What the return value contains

    Raises:
        ValueError: When and why this is raised (if applicable)
    """
```

---

## 4. Type Annotations — Every Function

Every function parameter and return value must have a type annotation.

**Required on:**
- All function parameters
- All return values
- Module-level constants

**Accepted types:** str, int, float, bool, dict, list, List, Tuple, Optional, Any, Union

---

## 5. Error Handling — Every Function

Every function must handle failures gracefully. Raw exceptions must never reach the user.

**Pattern:**

```
def function_name(param: str) -> dict:
    try:
        # main logic
        return {"success": True, "data": result}
    except SpecificException as e:
        return {"success": False, "error": str(e), "data": None}
    except Exception as e:
        return {"success": False, "error": f"Unexpected error: {str(e)}", "data": None}
```

**Rules:**
- Always catch the most specific exception first
- Always catch generic Exception as final fallback
- Always return a structured dict — never raise to the caller
- Error message must be human-readable — not a raw Python traceback

---

## 6. Hardcoded Healthcare Rules

These values must be used exactly as written. Never use magic numbers or strings for these.

**Drug interaction severity levels requiring physician review:**
- HIGH
- CONTRAINDICATED

**Drug interaction severity levels that can auto-approve:**
- LOW (with monitoring note)

**Confidence threshold for human escalation:**
- 0.90 (90%) — anything below triggers escalation recommendation

**Confidence score deductions:**
- Allergy conflict found: deduct 0.20
- Drug interaction found: deduct 0.10

**Maximum review loop iterations in LangGraph:**
- 3 — never exceed this

**HIPAA — fields that must never appear in logs:**
- name, ssn, dob, address, phone, email, mrn

**Source citations required for:**
- Every drug interaction claim
- Every allergy conflict finding
- Every verification result

**Disclaimer text (append to every agent response):**
```
This information is generated by an AI assistant and is intended to support —
not replace — clinical judgment. Always consult a qualified healthcare
professional before making medical decisions.
```

---

## 7. Eval Test Case Format

All test cases must follow Gauntlet's YAML format exactly.

**File location:** `eval/golden_data.yaml`

**Format:**
```yaml
test_cases:
  - id: "gs-001"
    category: "happy_path"
    query: "What medications is John Smith on?"
    expected_tools:
      - tool_get_patient_info
      - tool_get_medications
    expected_sources:
      - mock_data/medications.json
    must_contain:
      - "metformin"
      - "lisinopril"
    must_not_contain:
      - "I don't know"
      - "I cannot help"
    difficulty: "happy_path"
```

**Required fields:** id, category, query, expected_tools, must_contain, must_not_contain, difficulty

**must_not_contain must always include at minimum:**
- "I don't know"
- "error"
- Any harmful medical information relevant to the test case

---

## 8. Regression Testing Rule

After every new feature is added, run the full eval suite before moving on.

**Command:**
```
python eval/run_eval.py
```

**Rule:** If any test case that previously passed now fails — stop. Fix the regression before proceeding. Do not move forward with a regression present.

**Results must be saved** to `tests/results/` with a descriptive filename after every run.

---

## 9. File Naming

| File type | Convention | Example |
|-----------|-----------|---------|
| Python modules | snake_case | healthcare_guidelines.py |
| Test files | test_ prefix | test_verification.py |
| Test results | descriptive name | test_verification_results.txt |
| Eval data | descriptive name | golden_data.yaml |
| Config files | standard names | .env, .gitignore |

---

## 10. What Never Goes in Code

- API keys — always in .env, never hardcoded
- Magic numbers for healthcare thresholds — always use constants from healthcare_guidelines.py
- Patient names or identifiers in log statements
- Raw exception tracebacks returned to users
- TODO comments in committed code — finish it or remove it
